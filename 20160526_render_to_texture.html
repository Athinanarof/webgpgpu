<html>
<script src="colormaps.js"></script>
<script src="webgl_raster.js"></script>

<script id="screen-fragment" type="x-shader/x-fragment">//<![CDATA[
// This shader will be rendered to the screen
precision mediump float;
uniform sampler2D rtt_sampler;
void main() {
    float index = mod(gl_FragCoord.x+gl_FragCoord.y,256.) ;
    vec4 sample = texture2D(
        rtt_sampler, gl_FragCoord.xy/512.0);
    gl_FragColor =
        gl_FragCoord.y < 128.? vec4(1,index/256.,0,1) : sample;
}
//]]></script>

<script id="rtt-fragment" type="x-shader/x-fragment">//<![CDATA
// This shader will be rendered to a texture
precision mediump   float;
uniform   sampler2D u_palette_1;
void main() {
    float index  = mod(gl_FragCoord.x+gl_FragCoord.y,256.) ;
    vec4 sample = texture2D(
        u_palette_1,
        vec2((index + 0.5) / 256.0, 0.5));
    gl_FragColor =
        gl_FragCoord.x < 128.? vec4(0,0.5,1,1) :
        gl_FragCoord.x > 500.? vec4(1,0,0,1) : sample;

}
//]]></script>

<script>
// This is the main script that will run when the website loads
function main()
{
    // Retrieve a handle to the canvas element
    var canvas = $("maincanvas");

    // Try to create a WebGL context on the canvas, abort if it fails
    var gl = getRasterGL(canvas);
    if (!gl) return;

    // Render to texture test -- hold on to your hats
    var buffer          = newBasicFramebuffer(gl,canvas.width);
    var texture_program = getRasterProgram(gl,'rtt-fragment');
    bindColormap(gl,texture_program,"u_palette_1",0,colormap1());

    var screen_program  = getRasterProgram(gl,'screen-fragment');
    bindTexture (gl,screen_program ,"rtt_sampler",1,buffer.texture);

    renderProgram(gl,texture_program,buffer);
    renderProgram(gl,screen_program);
}
</script>
<body onload="javascript:main()">
<canvas id='maincanvas' style="width:512px;height:512px;"></canvas>
</body>
</html>
